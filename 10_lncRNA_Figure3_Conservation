##A) cumulative freq vs % seq_identity*%seq_coverage
#genes vs lncRNA against human
setwd("~/Desktop/lncRNA")
blast_genes <- read.table("human_genes_nt.outfmt6")
blast_lncRNA <- read.table("lncRNA_hg_nt.outfmt6")
##[3]=%identity,

#make a new column in dataset that is %identity*%coverage
library(plyr)
blast_lncRNA_new<- ddply(blast_lncRNA, c("V1"), summarise,
                         cons=V3*(V4/100))
blast_genes_new<- ddply(blast_genes, c("V1"), summarise,
                         cons=V3*(V4/100))

#need to calc or count-freq of each identity*coverage then cumsum(this)=y
blast_lncRNA_freq <- count(blast_lncRNA_new,'cons')
blast_genes_freq <- count(blast_genes_new,'cons')

blast_lncRNA_freq_cumsum <- cbind(blast_lncRNA_freq,cumsum(blast_lncRNA_freq$freq))
blast_genes_freq_cumsum <- cbind(blast_genes_freq,cumsum(blast_genes_freq$freq))

names(blast_lncRNA_freq_cumsum)[3] <-"cumsum" 
names(blast_genes_freq_cumsum)[3] <-"cumsum"
#divide the cumulative sum by the number of rows in the blast_lncRNA and blast_genes
#to get cumulative relative freq
blast_lncRNA_freq_cumsum["cum_rel"]<-(blast_lncRNA_freq_cumsum$cumsum/6932)
blast_genes_freq_cumsum["cum_rel"]<-(blast_genes_freq_cumsum$cumsum/464021)

blast_lncRNA_gene_cumsum_rel <- rbind(data.frame(id="lncRNA",blast_lncRNA_freq_cumsum),
                            data.frame(id="PCG",blast_genes_freq_cumsum))
write.table(blast_lncRNA_gene_cumsum_rel, "blast_lncRNA_gene_cumsum_rel.txt")
# plot
require(ggplot2)
ggplot(blast_lncRNA_gene_cumsum_rel, aes(x=cons, y=cum_rel, colour=id, group=id)) + 
  geom_line() + xlab("Blast %identity* Blast % coverage") + 
  ylab("cumulative frequency") + scale_color_discrete(name="Type of annotation")

##for promoters and down of lncRNA and genes
setwd("~/Desktop/lncRNA")
blast_genes_promoter <- read.table("genepromoter_human_nt.outfmt6")
blast_genes_down <- read.table("genedown_human_nt.outfmt6")
blast_lncRNA_promoter <- read.table("lncRNApromoter_human_nt.outfmt6")
blast_lncRNA_down <- read.table("lncRNAdown_human_nt.outfmt6")

library(plyr)
blast_lncRNA_promoter_new<- ddply(blast_lncRNA_promoter, c("V1"), summarise,
                         cons=V3*(V4/100))
blast_lncRNA_down_new<- ddply(blast_lncRNA_down, c("V1"), summarise,
                                  cons=V3*(V4/100))
blast_genes_promoter_new<- ddply(blast_genes_promoter, c("V1"), summarise,
                        cons=V3*(V4/100))
blast_genes_down_new<- ddply(blast_genes_down, c("V1"), summarise,
                                  cons=V3*(V4/100))

blast_lncRNA_promoter_freq <- count(blast_lncRNA_promoter_new,'cons')
blast_lncRNA_down_freq <- count(blast_lncRNA_down_new,'cons')
blast_genes_promoter_freq <- count(blast_genes_promoter_new,'cons')
blast_genes_down_freq <- count(blast_genes_down_new,'cons')

blast_lncRNA_promoter_cumsum <- cbind(blast_lncRNA_promoter_freq,cumsum(blast_lncRNA_promoter_freq$freq))
blast_lncRNA_down_cumsum <- cbind(blast_lncRNA_down_freq,cumsum(blast_lncRNA_down_freq$freq))
blast_genes_promoter_cumsum <- cbind(blast_genes_promoter_freq,cumsum(blast_genes_promoter_freq$freq))
blast_genes_down_cumsum <- cbind(blast_genes_down_freq,cumsum(blast_genes_down_freq$freq))

names(blast_lncRNA_promoter_cumsum)[3] <-"cumsum" 
names(blast_lncRNA_down_cumsum)[3] <-"cumsum" 
names(blast_genes_promoter_cumsum)[3] <-"cumsum" 
names(blast_genes_down_cumsum)[3] <-"cumsum" 

#divide the cumulative sum by the number of rows in the blast_lncRNA and blast_genes
#to get cumulative relative freq
blast_lncRNA_promoter_cumsum["cum_rel"]<-(blast_lncRNA_promoter_cumsum$cumsum/2130)
blast_lncRNA_down_cumsum["cum_rel"]<-(blast_lncRNA_down_cumsum$cumsum/2184)
blast_genes_promoter_cumsum["cum_rel"]<-(blast_genes_promoter_cumsum$cumsum/11823)
blast_genes_down_cumsum["cum_rel"]<-(blast_genes_down_cumsum$cumsum/11830)

blast_lncRNA_gene_PD_cumsum_rel <- rbind(data.frame(id="lncRNA_promoters",blast_lncRNA_promoter_cumsum),
                                         data.frame(id="lncRNA_down",blast_lncRNA_down_cumsum),
                                         data.frame(id="gene_promoters",blast_genes_promoter_cumsum),
                                         data.frame(id="gene_down",blast_genes_down_cumsum))
write.table(blast_lncRNA_gene_PD_cumsum_rel,"blast_lncRNA_gene_PD_cumsum_rel.txt")                                     
# plot
require(ggplot2)
ggplot(blast_lncRNA_gene_PD_cumsum_rel, aes(x=cons, y=cum_rel, colour=id, group=id)) + 
  geom_line(position=position_dodge(width=0.2)) + xlab("Blast %identity* Blast % coverage") + 
  ylab("cumulative frequency") + scale_color_discrete(name="Type of annotation")
